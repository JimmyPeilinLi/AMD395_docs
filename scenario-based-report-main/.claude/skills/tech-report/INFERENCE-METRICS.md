# 推理框架评估指标体系

## 核心性能指标

### 1. 延迟指标

| 指标 | 全称 | 定义 | 单位 |
|------|------|------|------|
| **TTFT** | Time To First Token | 从请求发送到收到第一个 token 的时间 | ms |
| **TPOT** | Time Per Output Token | 生成每个输出 token 的平均时间 | ms |
| **TPS** | Tokens Per Second | 单路每秒生成的 token 数（= 1/TPOT） | tok/s |
| **E2E Latency** | End-to-End Latency | 完整请求的总延迟 | ms |
| **P50/P90/P99** | 百分位延迟 | 延迟分布的百分位数 | ms |

**计算公式**：
```
TPS = 1 / TPOT
E2E Latency = TTFT + (output_tokens - 1) × TPOT
```

**TPOT vs TPS**：
- TPOT 越小越好（延迟视角）
- TPS 越大越好（吞吐视角）
- 两者互为倒数，报告中建议同时提供，方便不同视角参考

### 2. 吞吐量指标

| 指标 | 定义 | 单位 |
|------|------|------|
| **QPS** | 每秒处理的请求数 | req/s |
| **Throughput** | 每秒生成的 token 数 | tokens/s |
| **Concurrent Users** | 同时支持的并发用户数 | - |

### 3. 资源效率指标

| 指标 | 定义 | 单位 |
|------|------|------|
| **GPU Utilization** | GPU 计算单元利用率 | % |
| **Memory Usage** | 显存占用 | GB |
| **Memory Efficiency** | 显存利用效率（有效/占用） | % |

---

## 标准测试矩阵

### 输入输出长度组合

| 场景 | 输入长度 | 输出长度 | 典型应用 |
|------|----------|----------|----------|
| 短输入短输出 | 128 | 128 | 简单问答 |
| 短输入长输出 | 128 | 2048 | 内容生成 |
| 长输入短输出 | 4096 | 128 | 文档摘要 |
| 长输入长输出 | 4096 | 2048 | 长文分析 |
| 超长上下文 | 32K+ | 2048 | RAG 场景 |

### 并发测试矩阵

| 并发数 | 测试目的 |
|--------|----------|
| 1 | 基准性能，无排队 |
| 8 | 轻负载 |
| 32 | 中等负载 |
| 64 | 高负载 |
| 128+ | 压力测试，找到性能拐点 |

### 完整测试矩阵模板

```markdown
| 输入长度 | 输出长度 | 并发数 | TTFT(ms) | TPOT(ms) | TPS | 吞吐量(tokens/s) |
|----------|----------|--------|----------|----------|-----|------------------|
| 128      | 128      | 1      |          |          |     |                  |
| 128      | 128      | 32     |          |          |     |                  |
| 128      | 2048     | 1      |          |          |     |                  |
| 128      | 2048     | 32     |          |          |     |                  |
| 4096     | 128      | 1      |          |          |     |                  |
| 4096     | 128      | 32     |          |          |     |                  |
| 4096     | 2048     | 1      |          |          |     |                  |
| 4096     | 2048     | 32     |          |          |     |                  |
```

> 注：TPS = 1000 / TPOT(ms)，表示单路每秒生成 token 数

---

## 测试环境标准化

### 硬件环境记录模板

```yaml
硬件配置:
  GPU型号:
  GPU数量:
  GPU显存:
  CPU型号:
  内存大小:
  网络带宽:

软件环境:
  操作系统:
  驱动版本:
  CUDA版本:
  框架版本:
  模型版本:
```

### 测试条件记录

```yaml
测试条件:
  预热请求数: 100
  正式测试请求数: 1000
  测试时长:
  采样方式:
  数据集:
```

---

## 对比测试规范

### 公平对比原则

1. **相同硬件环境**：或等价硬件配置
2. **相同测试数据**：使用相同的 prompt 和期望输出长度
3. **相同测试工具**：使用相同的压测工具和参数
4. **充分预热**：确保系统进入稳定状态
5. **多次测试**：取平均值，标注标准差

### 常用压测工具

| 工具 | 特点 | 适用场景 |
|------|------|----------|
| vLLM benchmark | vLLM 自带 | vLLM 框架测试 |
| llmperf | LLM 专用 | 通用 LLM 测试 |
| locust | 通用压测 | 自定义场景 |
| wrk / hey | HTTP 压测 | API 接口测试 |

---

## 数据呈现建议

### 表格呈现

适合精确数据对比：

```markdown
| 指标 | 我们的方案 | 竞品方案 | 提升幅度 |
|------|-----------|----------|----------|
| TTFT (P50) | 45ms | 78ms | 42%↓ |
| TPOT | 12ms | 18ms | 33%↓ |
| TPS | 83.3 | 55.6 | 50%↑ |
| 吞吐量@32并发 | 2666 tok/s | 1780 tok/s | 50%↑ |
```

### 图表呈现

推荐图表类型：
- **柱状图**：不同方案的指标对比
- **折线图**：不同并发下的性能变化
- **热力图**：输入输出长度 × 并发的性能矩阵

### 关键数据突出

外部版报告中，选择最有说服力的 2-3 个数据点：
- 最典型场景的性能数据
- 提升幅度最大的指标
- 客户最关心的指标

---

## 常见场景的关键指标

| 应用场景 | 最关键指标 | 次要指标 |
|----------|-----------|----------|
| 实时对话 | TTFT, TPOT | P99 延迟 |
| 批量处理 | 吞吐量, QPS | GPU 利用率 |
| 长文档分析 | 长上下文性能, 显存 | TTFT |
| 高并发服务 | QPS, P99 延迟 | 资源利用率 |
| 成本敏感 | tokens/$ | 吞吐量 |
